<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íŠ¸ë¦¼2ë°˜ ì‘ì—… ìŠ¤ì¼€ì¤„ ì¡°íšŒ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- âœ… PWA(í™ˆí™”ë©´ ì•„ì´ì½˜/ì•±ì²˜ëŸ¼ ì‹¤í–‰) -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111111">

<!-- âœ… iOS(ì•„ì´í°) í™ˆí™”ë©´ ì•„ì´ì½˜/ì•±ëª¨ë“œ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="T2B">
<link rel="apple-touch-icon" href="icon-192.png">

<!-- âœ… Android/ë¸Œë¼ìš°ì € íƒ­ ì•„ì´ì½˜ -->
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f5f5f7;color:#222;}
.container{max-width:960px;margin:0 auto;padding:16px;}
.card{background:#fff;border-radius:16px;padding:14px;margin-bottom:16px;box-shadow:0 6px 16px rgba(0,0,0,.06);}
h2{font-size:16px;margin-bottom:10px;text-align:center;}
input{padding:6px 10px;font-size:14px;border-radius:8px;border:1px solid #ccc;}
button.primary{padding:8px 16px;border-radius:999px;border:none;background:#007aff;color:#fff;}
.warning{color:#c00;font-size:13px;margin-top:6px;text-align:center;}
.date-row{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:6px;}

/* âœ… ëª¨ë°”ì¼ í‘œ ì‹œì¸ì„± ê°œì„  */
.table-wrap{overflow-x:auto;margin-top:8px;}

table{
  border-collapse:collapse;
  width:100%;
  min-width:0;
  table-layout:fixed;  /* âœ… 1R~4R ì¹¸í­ ê· ë“± */
  font-size:12px;
}

th,td{
  padding:4px 4px;     /* âœ… ê°„ê²© ì¢íˆê¸° */
  border-bottom:1px solid #eee;
  text-align:center;
  white-space:nowrap;
}

th{background:#fafafa;}
thead th{border-bottom:2px solid #e5e5e5;}

/* âœ… ì´ë¦„ì¹¸: ê²½ê³„ì„  ëŒ€ì‹  ì˜…ì€ ë°°ê²½ìœ¼ë¡œ êµ¬ë¶„ */
.name-col{
  position:sticky;
  left:0;
  background:#f3f4f6;  /* âœ… ì˜…ì€ ë°°ê²½ */
  font-weight:700;
  z-index:2;
  width:58px;
  max-width:58px;
}

/* âœ… 1R~4R ì‚¬ì´ ì–‡ì€ ì„¸ë¡œì„ (êµ¬ë¶„ì„ ) */
th:not(.name-col), td:not(.name-col){
  border-left:1px solid #eee;
}

/* ë¼ìš´ë“œ ì‹œì¸ì„±(ë ˆë“œì˜¤ë Œì§€ê·¸ë¦°ë„¤ì´ë¹„) */
.round-1{color:#C62828;}
.round-2{color:#EF6C00;}
.round-3{color:#1B5E20;}
.round-4{color:#1F2A5A;}
/* íœ´ë¬´ í‘œì‹œ */
.off{color:#c00;font-weight:800;}

/* âœ… ì§€ë¸Œë¼(ì¤„ë¬´ëŠ¬) - ì‘ì—…ì¹¸ë§Œ ì•„ì£¼ ì˜…ê²Œ */
tbody tr:nth-child(even) td:not(.name-col){ background:#fcfcfd; }
tbody tr:nth-child(odd)  td:not(.name-col){ background:#ffffff; }

/* ì´ë¦„ì¹¸ì€ í•­ìƒ ê°™ì€ ì˜…ì€ ë°°ê²½ ìœ ì§€ */
tbody td.name-col{ background:#f3f4f6; }

/* (ì„ íƒ) í„°ì¹˜ì‹œ ì‚´ì§ ê°•ì¡° */
tbody tr:active td{ background:#f1f7ff; }

/* â“ ë„ì›€ë§ ë²„íŠ¼ */
.help-btn{position:fixed;right:14px;bottom:14px;width:44px;height:44px;border-radius:50%;border:none;background:#007aff;color:#fff;font-size:22px;font-weight:800;box-shadow:0 4px 10px rgba(0,0,0,.25);z-index:50;}
/* ê³µì§€ */
.notice{font-size:12.5px;line-height:1.55;color:#333;background:#fafafa;border:1px solid #eee;border-radius:12px;padding:10px;}
.notice .tag{display:inline-block;font-size:11px;padding:2px 8px;border-radius:999px;background:#111;color:#fff;margin-right:6px;}
.footer{font-size:12px;color:#666;text-align:center;margin-top:10px;}
</style>
</head>

<body>

<div class="container">

  <!-- âœ… ê³µì§€: ë§¨ ìœ„ë¡œ ì´ë™ -->
  <div class="card">
    <h2>ğŸ“Œ ê³µì§€</h2>
    <div class="notice" id="noticeBox"></div>
    <div class="footer" id="footerBox"></div>
  </div>

  <!-- âœ… ì „ì²´ ìŠ¤ì¼€ì¤„ -->
  <div class="card">
    <h2>ğŸš—ğŸš™ íŠ¸ë¦¼ 2ë°˜ ì „ì²´ ìŠ¤ì¼€ì¤„ ì¡°íšŒ ğŸš•ğŸš“</h2>

    <div class="date-row">
      <input type="date" id="dayDate">
      <button class="primary" onclick="renderDay()">ì¡°íšŒ</button>
    </div>

    <div id="dayWarn" class="warning"></div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th class="name-col">ì´ë¦„</th>
            <th>1R</th>
            <th>2R</th>
            <th>3R</th>
            <th>4R</th>
          </tr>
        </thead>
        <tbody id="dayBody"></tbody>
      </table>
    </div>
  </div>

</div>

<button class="help-btn" id="helpBtn">?</button>

<script>
/* =========================
   0) ê³µì§€/ë²„ì „ (ìŠ¤ì¼€ì¤„ê³¼ ì™„ì „ ë¶„ë¦¬)
========================= */
const APP_VERSION = "vFinal";
const LAST_UPDATED = "2026-01-16";

const NOTICE_LINES = [
  "2026-01-19  ë¬¸ì •, ì¡±ì¥(SCU) ì¶”ê°€",
  "2026-01-22 4R ì„ ê±°íœ´ë¬´ ë°˜ì˜",
  "ì„¤ë‚  íœ´ë¬´ (2026-02-16 ~ 2026-02-19)"
];

function renderNotice(){
  const el = document.getElementById("noticeBox");
  el.innerHTML = NOTICE_LINES.map(t =>
    `<div><span class="tag">ğŸ€</span> ${t}</div>`
  ).join("");
  document.getElementById("footerBox").textContent =
    `ìµœì¢… ìˆ˜ì •ì¼: ${LAST_UPDATED}`;
}

/* =========================
   1) ë‚ ì§œ ìœ í‹¸ (ì•„ì´í° ì•ˆì „)
========================= */
function parseDate(v){
  if(!v) return null;
  const [y,m,d] = v.split('-').map(Number);
  return new Date(y, m-1, d);
}
function pad2(n){ return String(n).padStart(2,'0'); }
function isoLocal(d){
  return d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate());
}

/* =========================
   2) ê¸°ë³¸ ì„¤ì •
========================= */
const START = parseDate("2026-01-05");

/* ì„¤ë‚  íœ´ë¬´ */
const HOLIDAYS = ["2026-02-16","2026-02-17","2026-02-18","2026-02-19"];

/* âœ… ë¼ìš´ë“œë³„ íœ´ë¬´(=ê·¸ ë¼ìš´ë“œëŠ” ìˆ˜í–‰ ì•ˆ í•¨, ë‹¤ìŒë‚ ë¡œ ì´ì›”) */
const ROUND_OFF = {
  "2026-01-22": [4] // 22ì¼ 4ë¼ìš´ë“œ ì „ì²´ íœ´ë¬´ â†’ 23ì¼ 1ë¼ìš´ë“œë¡œ ì´ì›”(í•œ ì¹¸ ë°€ë¦¼)
};

/* =========================
   3) ë°ì´í„° êµ¬ê°„ (1/19 ì „/í›„)
========================= */
/* 1/19 ì´ì „(ê¸°ì¤€ 1/13) */
const DATA_V1 = {
  from: "2026-01-05",
  to:   "2026-01-18",
  baseDate: "2026-01-13",
  baseTask: "LHíœ€ë‹¤",
  basePerson: "ê°‘ìˆ˜",
  workers: [
    "ì˜í›ˆ","ê°‘ìˆ˜","ê¸°ë°±","ìš°ë¹ˆ","ìŠ¹í˜¸","ì›…ê¸°","í•™í˜„","ë²”ì„±","ì„±í•´",
    "ì‘ê·œ","ì˜í™˜","ìƒê±´","ì¬ë•","ì˜¥ì—°","ìˆ˜ì‹ ","ì˜¤ì±„","ì€ìš°","ì •í›ˆ","ìš©ë‚¨",
    "ì„±í›ˆ","ì›ë¹ˆ","ê¸¸ìš´","ëŒ€í˜„","ì§„ì†”","ì¤€í˜„","ì„œì§„","ì´ìŠ¬","ë¯¼êµ­","ì„±ì²œ","ì¶©í›ˆ"
  ],
  tasks: [
    "LHíœ€ë‹¤","LH Bí•„ë¼","Lì—ì–´ë°±íˆ¬ì…","2ì¡°1ë²ˆ","LH Cí•„ë¼",
    "SKì£¼ìœ êµ¬","ë©¤ë²„ì–´ìŠ¤","LH Aí•„ë¼","ë§ˆìŠ¤í„°ë°±","Lë„ì–´íƒˆê±°",
    "ë‚š1","ë²”í¼ê°€ì´ë“œ","2ì¡°2ë²ˆ","ASì»¤ë²„","LH ë£¨1","LH ë£¨2",
    "RH íœ€ë‹¤","RH Bí•„ë¼","Rì—ì–´ë°±íˆ¬ì…","RH Cí•„ë¼","R Aí•„ë¼",
    "í›„ë“œ","3ì¡°1ë²ˆ","Rë„ì–´íƒˆê±°","í•˜ì´ë“œë¡œë‹‰ì²´ê²°","ë‚š2","ì—”ì§„ì–´ìŠ¤",
    "3ì¡°2ë²ˆ","RH ë£¨1","RH ë£¨2"
  ]
};

/* 1/19 ì´í›„(ë¬¸ì •/ì¡±ì¥ ì¶”ê°€, ê¸°ì¤€ 1/19 / LHíœ€ë‹¤ = ìƒê±´) */
const DATA_V2 = {
  from: "2026-01-19",
  to:   "2099-12-31",
  baseDate: "2026-01-19",
  baseTask: "LHíœ€ë‹¤",
  basePerson: "ìƒê±´",
  workers: [
    "ì˜í›ˆ","ê°‘ìˆ˜","ê¸°ë°±","ìš°ë¹ˆ","ìŠ¹í˜¸","ì›…ê¸°","í•™í˜„","ë²”ì„±","ì„±í•´",
    "ì‘ê·œ","ì˜í™˜","ìƒê±´","ì¬ë•","ì˜¥ì—°","ìˆ˜ì‹ ","ì˜¤ì±„","ì€ìš°","ì •í›ˆ","ìš©ë‚¨",
    "ì„±í›ˆ","ì›ë¹ˆ","ê¸¸ìš´","ëŒ€í˜„","ì§„ì†”","ì¤€í˜„","ë¬¸ì •","ì„œì§„","ì´ìŠ¬","ë¯¼êµ­","ì„±ì²œ","ì¶©í›ˆ"
  ],
  tasks: [
    "LHíœ€ë‹¤","LH Bí•„ë¼","Lì—ì–´ë°±íˆ¬ì…","2ì¡°1ë²ˆ","LH Cí•„ë¼",
    "SKì£¼ìœ êµ¬","ë©¤ë²„ì–´ìŠ¤","LH Aí•„ë¼","ë§ˆìŠ¤í„°ë°±","Lë„ì–´íƒˆê±°",
    "ë‚š1","ë²”í¼ê°€ì´ë“œ","2ì¡°2ë²ˆ","ASì»¤ë²„","ì¡±ì¥(SCU)","LH ë£¨1","LH ë£¨2",
    "RH íœ€ë‹¤","RH Bí•„ë¼","Rì—ì–´ë°±íˆ¬ì…","RH Cí•„ë¼","R Aí•„ë¼",
    "í›„ë“œ","3ì¡°1ë²ˆ","Rë„ì–´íƒˆê±°","í•˜ì´ë“œë¡œë‹‰ì²´ê²°","ë‚š2","ì—”ì§„ì–´ìŠ¤",
    "3ì¡°2ë²ˆ","RH ë£¨1","RH ë£¨2"
  ]
};

function pickData(dateIso){
  return (dateIso >= DATA_V2.from) ? DATA_V2 : DATA_V1;
}

/* =========================
   4) ê·¼ë¬´/ë¼ìš´ë“œíœ´ë¬´ íŒë‹¨
========================= */
function isWork(d){
  if(!d) return false;
  if(d < START) return false;
  if(d.getDay() === 0) return false; // ì¼ìš”ì¼
  return !HOLIDAYS.includes(isoLocal(d));
}
function isRoundOff(dateIso, roundNum){
  const arr = ROUND_OFF[dateIso];
  return !!(arr && arr.includes(roundNum));
}

/* =========================
   5) (íœ´ë¬´ ë¼ìš´ë“œ ì œì™¸) ëˆ„ì  ë¼ìš´ë“œ ê³„ì‚°
========================= */
function roundsDoneBeforeDate(data, targetDate){
  const targetIso = isoLocal(targetDate);
  const baseD = parseDate(data.baseDate);
  if(!baseD) return 0;

  const forward = (targetDate >= baseD);
  let sum = 0;

  if(forward){
    let d = new Date(baseD.getTime());
    while(isoLocal(d) < targetIso){
      if(isWork(d)){
        const iso = isoLocal(d);
        let offCnt = 0;
        for(let r=1;r<=4;r++) if(isRoundOff(iso, r)) offCnt++;
        sum += (4 - offCnt);
      }
      d.setDate(d.getDate()+1);
    }
    return sum;
  } else {
    let d = new Date(targetDate.getTime());
    while(isoLocal(d) < isoLocal(baseD)){
      if(isWork(d)){
        const iso = isoLocal(d);
        let offCnt = 0;
        for(let r=1;r<=4;r++) if(isRoundOff(iso, r)) offCnt++;
        sum += (4 - offCnt);
      }
      d.setDate(d.getDate()+1);
    }
    return -sum;
  }
}

/* í•˜ë£¨ ì•ˆì—ì„œ "ì‹¤ì œ ìˆ˜í–‰ë˜ëŠ”" ë¼ìš´ë“œ ì¸ë±ìŠ¤(íœ´ë¬´ ì œì™¸) */
function performedIndexInDay(dateIso, roundNum){
  if(isRoundOff(dateIso, roundNum)) return null;
  let idx = 0;
  for(let r=1;r<roundNum;r++){
    if(!isRoundOff(dateIso, r)) idx++;
  }
  return idx;
}

/* =========================
   6) ìŠ¤ì¼€ì¤„ ê³„ì‚° (íœ´ë¬´ ë¼ìš´ë“œ ì´ì›”/ë°€ë¦¼ ë°˜ì˜)
========================= */
function getScheduleForDate(targetDate){
  if(!isWork(targetDate)) return null;

  const dateIso = isoLocal(targetDate);
  const data = pickData(dateIso);
  const workers = data.workers;
  const tasks = data.tasks;

  const baseTaskIdx = tasks.indexOf(data.baseTask);
  const basePersonIdx = workers.indexOf(data.basePerson);
  if(baseTaskIdx < 0 || basePersonIdx < 0) return null;

  const offsetRounds = roundsDoneBeforeDate(data, targetDate);

  return workers.map((name, personIdx)=>{
    const personDelta = personIdx - basePersonIdx;
    const rounds = [];

    for(let roundNum=1; roundNum<=4; roundNum++){
      const pi = performedIndexInDay(dateIso, roundNum);
      if(pi === null){
        rounds.push("íœ´ë¬´");
        continue;
      }
      const taskIdx = (baseTaskIdx + offsetRounds + personDelta + pi) % tasks.length;
      rounds.push(tasks[(taskIdx + tasks.length) % tasks.length]);
    }
    return { name, rounds };
  });
}

/* =========================
   7) í™”ë©´ ì¶œë ¥
========================= */
function renderDay(){
  const d = parseDate(document.getElementById("dayDate").value);
  const dayBody = document.getElementById("dayBody");
  const dayWarn = document.getElementById("dayWarn");
  dayBody.innerHTML = "";

  if(!d || !isWork(d)){
    dayWarn.textContent = "íœ´ë¬´ì¼ì…ë‹ˆë‹¤.";
    return;
  }

  const s = getScheduleForDate(d);
  if(!s){
    dayWarn.textContent = "ìŠ¤ì¼€ì¤„ ê³„ì‚°ì— ë¬¸ì œê°€ ìˆì–´ìš”. (ê¸°ì¤€/ëª…ë‹¨/ì‘ì—… ìˆœì„œ í™•ì¸ í•„ìš”)";
    return;
  }

  dayWarn.textContent = "";

  s.forEach(r=>{
    const c1 = (r.rounds[0]==="íœ´ë¬´") ? "off" : "round-1";
    const c2 = (r.rounds[1]==="íœ´ë¬´") ? "off" : "round-2";
    const c3 = (r.rounds[2]==="íœ´ë¬´") ? "off" : "round-3";
    const c4 = (r.rounds[3]==="íœ´ë¬´") ? "off" : "round-4";

    dayBody.innerHTML += `
      <tr>
        <td class="name-col">${r.name}</td>
        <td class="${c1}">${r.rounds[0]}</td>
        <td class="${c2}">${r.rounds[1]}</td>
        <td class="${c3}">${r.rounds[2]}</td>
        <td class="${c4}">${r.rounds[3]}</td>
      </tr>
    `;
  });
}

function goToday(){
  const t = new Date();
  const d = isWork(t) ? t : START;
  document.getElementById("dayDate").value = isoLocal(d);
  renderDay();
}

/* ë„ì›€ë§ */
document.getElementById("helpBtn").addEventListener("click", ()=>{
  alert(`ë§Œë“ ì‚¬ëŒ : ê¹€ì´ìŠ¬\në²„ì „ : ${APP_VERSION}\nìµœì¢… ìˆ˜ì •ì¼ : ${LAST_UPDATED}`);
});

/* ìµœì´ˆ ì‹¤í–‰ */
renderNotice();
goToday();
</script>

<!-- âœ… (ê¶Œì¥) ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("sw.js");
  });
}
</script>

</body>
</html>