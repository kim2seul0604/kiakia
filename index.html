<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>트림2반 작업 스케줄</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f5f5f7}
header{background:#111;color:#fff;padding:14px;text-align:center;position:sticky;top:0}
.today-btn{margin-top:8px;padding:6px 16px;border:none;border-radius:999px;background:#0a8a43;color:#fff}
.container{max-width:960px;margin:auto;padding:16px}
.card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
.date-row{display:flex;justify-content:center;gap:8px;margin-bottom:6px}
table{border-collapse:collapse;font-size:11.5px;width:max-content}
th,td{padding:6px 8px;border-bottom:1px solid #eee;text-align:center;white-space:nowrap}
th{background:#fafafa}
.name-col{position:sticky;left:0;background:#fff;font-weight:700}
.round-1{color:#aaa}
.round-2{color:#777}
.round-3{color:#444}
.round-4{color:#000;font-weight:600}
.help-btn{position:fixed;right:14px;bottom:14px;width:44px;height:44px;border-radius:50%;border:none;background:#007aff;color:#fff;font-size:22px}
</style>
</head>

<body>
<header>
  <div style="font-size:20px;font-weight:800;">트림2반 작업 스케줄</div>
  <button class="today-btn" onclick="goToday()">오늘</button>
</header>

<div class="container">
  <div class="card">
    <div class="date-row">
      <input type="date" id="dayDate">
      <button onclick="renderDay()">조회</button>
    </div>
    <div style="overflow-x:auto">
      <table>
        <thead>
          <tr>
            <th class="name-col">이름</th>
            <th>1R</th><th>2R</th><th>3R</th><th>4R</th>
          </tr>
        </thead>
        <tbody id="dayBody"></tbody>
      </table>
    </div>
  </div>
</div>

<button class="help-btn" onclick="alert('만든사람 : 김이슬\n최종 수정일 : 2026-01-15')">?</button>

<script src="data.js"></script>
<script>
function parse(d){const[a,b,c]=d.split("-").map(Number);return new Date(a,b-1,c)}
function iso(d){return d.toISOString().slice(0,10)}

function isWork(d){
  if(d < parse(START_DATE)) return false;
  if(d.getDay()===0) return false;
  return !HOLIDAYS.includes(iso(d));
}

function workIndex(d){
  let i=-1,t=parse(START_DATE);
  while(t<=d){
    if(isWork(t)) i++;
    if(iso(t)===iso(d)) return i;
    t.setDate(t.getDate()+1);
  }
  return null;
}

function getSchedule(d){
  const baseIdx=workIndex(parse(BASE_DATE));
  const todayIdx=workIndex(d);
  const dayShift=(todayIdx-baseIdx)*4;

  return workers.map((name,pIdx)=>{
    const rounds=[];
    for(let r=0;r<4;r++){
      const idx=(pIdx+dayShift+r)%tasks.length;
      rounds.push(tasks[idx]);
    }
    return {name,rounds};
  });
}

function renderDay(){
  const d=parse(dayDate.value);
  const body=document.getElementById("dayBody");
  body.innerHTML="";
  if(!d||!isWork(d)) return;
  getSchedule(d).forEach(r=>{
    body.innerHTML+=`
      <tr>
        <td class="name-col">${r.name}</td>
        <td class="round-1">${r.rounds[0]}</td>
        <td class="round-2">${r.rounds[1]}</td>
        <td class="round-3">${r.rounds[2]}</td>
        <td class="round-4">${r.rounds[3]}</td>
      </tr>`;
  });
}

function goToday(){
  const t=new Date();
  dayDate.value=iso(t);
  renderDay();
}
goToday();
</script>
</body>
</html>