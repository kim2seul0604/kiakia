<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íŠ¸ë¦¼2ë°˜ ì‘ì—… ìŠ¤ì¼€ì¤„ ì¡°íšŒ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#f5f5f7;
  color:#222;
}

header {
  background:#111;
  color:#fff;
  padding:16px;
  text-align:center;
  position:sticky;
  top:0;
  z-index:10;
}

.today-btn {
  margin-top:10px;
  padding:8px 18px;
  border:none;
  border-radius:999px;
  background:#0a8a43;
  color:#fff;
}

.container {
  max-width:960px;
  margin:0 auto;
  padding:16px;
}

.card {
  background:#fff;
  border-radius:16px;
  padding:14px;
  margin-bottom:16px;
  box-shadow:0 6px 16px rgba(0,0,0,.06);
}

h2 {
  font-size:16px;
  margin-bottom:10px;
  text-align:center;
}

input {
  padding:6px 10px;
  font-size:14px;
  border-radius:8px;
  border:1px solid #ccc;
}

button.primary {
  padding:8px 16px;
  border-radius:999px;
  border:none;
  background:#007aff;
  color:#fff;
}

.warning {
  color:#c00;
  font-size:13px;
  margin-top:6px;
  text-align:center;
}

/* ë‚ ì§œ + ì¡°íšŒ ë²„íŠ¼ ê°€ìš´ë° ì •ë ¬ */
.date-row {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin-bottom:6px;
}

.table-wrap {
  overflow-x:auto;
  margin-top:8px;
}

table {
  border-collapse:collapse;
  min-width:600px;
  width:max-content;
  font-size:11.5px;
}

th, td {
  padding:6px 8px;
  border-bottom:1px solid #eee;
  text-align:center;
  white-space:nowrap;
}

th {
  background:#fafafa;
}

.name-col {
  position:sticky;
  left:0;
  background:#fff;
  font-weight:700;
  z-index:2;
}

/* ë¼ìš´ë“œ ì‹œì¸ì„± (íŒŒë‘ê³„ì—´) */
.round-1 { color:#4B5FA8; }
.round-2 { color:#66B2FF; }
.round-3 { color:#1E88E5; }
.round-4 { color:#0D47A1; font-weight:600; }

/* ê³µì§€ */
.notice-box {
  width:100%;
  box-sizing:border-box;
  border:1px solid #ddd;
  border-radius:12px;
  padding:10px;
  font-size:13px;
  line-height:1.4;
  resize:vertical;
  min-height:90px;
}

.notice-row {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin-top:10px;
  flex-wrap:wrap;
}

.meta {
  font-size:12px;
  color:#666;
  text-align:center;
  margin-top:10px;
}

/* â“ ë„ì›€ë§ ë²„íŠ¼ */
.help-btn {
  position:fixed;
  right:14px;
  bottom:14px;
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:#007aff;
  color:#fff;
  font-size:22px;
  font-weight:800;
  box-shadow:0 4px 10px rgba(0,0,0,.25);
  z-index:50;
}
</style>
</head>

<body>

<header>
  <div style="font-size:22px;font-weight:800;">íŠ¸ë¦¼2ë°˜ ì‘ì—… ìŠ¤ì¼€ì¤„ ì¡°íšŒ</div>
  <button class="today-btn" onclick="goToday()">ì˜¤ëŠ˜ë„ í™”ì´íŒ…~â€¼ï¸</button>
</header>

<div class="container">

  <div class="card">
    <h2>ğŸ¥âœˆï¸ íŠ¸ë¦¼ 2ë°˜ ì „ì²´ ìŠ¤ì¼€ì¤„ ì¡°íšŒí•˜ê¸° ğŸ€ğŸ¥</h2>

    <div class="date-row">
      <input type="date" id="dayDate">
      <button class="primary" onclick="renderDay()">ì¡°íšŒ</button>
    </div>

    <div id="dayWarn" class="warning"></div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th class="name-col">ì´ë¦„</th>
            <th>1R</th>
            <th>2R</th>
            <th>3R</th>
            <th>4R</th>
          </tr>
        </thead>
        <tbody id="dayBody"></tbody>
      </table>
    </div>
  </div>

  <!-- ê³µì§€ ì¹´ë“œ -->
  <div class="card">
    <h2>ğŸ“Œ ê³µì§€</h2>
    <textarea id="notice" class="notice-box" placeholder="ì˜ˆ) 22ì¼ 4ë¼ìš´ë“œ ë°€ë¦¼ ë°˜ì˜&#10;ì˜ˆ) ì„¤ë‚  íœ´ë¬´ ë°˜ì˜"></textarea>
    <div class="notice-row">
      <button class="primary" id="saveNoticeBtn">ê³µì§€ ì €ì¥</button>
      <button class="primary" id="clearNoticeBtn" style="background:#888;">ê³µì§€ ì§€ìš°ê¸°</button>
    </div>
    <div class="meta" id="metaText"></div>
    <div class="meta" style="margin-top:6px;">â€» ê³µì§€ëŠ” â€œì´ ê¸°ê¸°(ë‚´ í°)â€ì— ì €ì¥ë¼ìš”. (ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ìë™ ê³µìœ ëŠ” ì•ˆ ë¨)</div>
  </div>

</div>

<!-- â“ ë„ì›€ë§ ë²„íŠ¼ -->
<button class="help-btn" id="helpBtn">?</button>

<script>
/* =========================
   ë²„ì „/ìˆ˜ì •ì¼
========================= */
const APP_VERSION = "v1.0.0";
const LAST_MODIFIED = "2026-01-19";

/* =========================
   ì•„ì´í° ì•ˆì „ ë‚ ì§œ íŒŒì‹±
========================= */
function parseDate(v){
  if(!v) return null;
  const parts = v.split("-").map(Number);
  if(parts.length !== 3) return null;
  return new Date(parts[0], parts[1]-1, parts[2]);
}

/* ë¡œì»¬(í•œêµ­ì‹œê°„) ISO ë¬¸ìì—´ */
function pad2(n){ return String(n).padStart(2,"0"); }
function isoLocal(d){
  return d.getFullYear() + "-" + pad2(d.getMonth()+1) + "-" + pad2(d.getDate());
}

/* =========================
   ê¸°ì¤€/ë°ì´í„° (1/19 ë°˜ì˜ë³¸)
========================= */
const START = new Date(2026,0,5); // ì‚¬ìš© ì‹œì‘ ê¸°ì¤€ (í•„ìš”í•˜ë©´ ìœ ì§€)

/* 1/19 ê¸°ì¤€: LHíœ€ë‹¤ ì‘ì—…ìëŠ” ìƒê±´ */
const BASE_DATE = new Date(2026,0,19);
const BASE_PERSON = "ìƒê±´";

/* íœ´ë¬´ì¼(ëª…ì ˆ) */
const HOLIDAYS = ["2026-02-16","2026-02-17","2026-02-18","2026-02-19"];

/* ì‘ì—…ì ìˆœì„œ (1/19ë¶€í„°: ì¤€í˜„-ë¬¸ì •-ì„œì§„) */
const names = [
  "ì˜í›ˆ","ê°‘ìˆ˜","ê¸°ë°±","ìš°ë¹ˆ","ìŠ¹í˜¸","ì›…ê¸°","í•™í˜„","ë²”ì„±","ì„±í•´",
  "ì‘ê·œ","ì˜í™˜","ìƒê±´","ì¬ë•","ì˜¥ì—°","ìˆ˜ì‹ ","ì˜¤ì±„","ì€ìš°","ì •í›ˆ","ìš©ë‚¨",
  "ì„±í›ˆ","ì›ë¹ˆ","ê¸¸ìš´","ëŒ€í˜„","ì§„ì†”","ì¤€í˜„","ë¬¸ì •","ì„œì§„","ì´ìŠ¬","ë¯¼êµ­","ì„±ì²œ","ì¶©í›ˆ"
];

/* ì‘ì—… ìˆœì„œ (1/19ë¶€í„°: ASì»¤ë²„ ë‹¤ìŒì— ì¡±ì¥(SCU) ì¶”ê°€) */
const tasks = [
  "LHíœ€ë‹¤","LH Bí•„ë¼","Lì—ì–´ë°±íˆ¬ì…","2ì¡°1ë²ˆ","LH Cí•„ë¼",
  "SKì£¼ìœ êµ¬","ë©¤ë²„ì–´ìŠ¤","LH Aí•„ë¼","ë§ˆìŠ¤í„°ë°±","Lë„ì–´íƒˆê±°",
  "ë‚š1","ë²”í¼ê°€ì´ë“œ","2ì¡°2ë²ˆ","ASì»¤ë²„","ì¡±ì¥(SCU)","LH ë£¨1","LH ë£¨2",
  "RH íœ€ë‹¤","RH Bí•„ë¼","Rì—ì–´ë°±íˆ¬ì…","RH Cí•„ë¼","R Aí•„ë¼",
  "í›„ë“œ","3ì¡°1ë²ˆ","Rë„ì–´íƒˆê±°","í•˜ì´ë“œë¡œë‹‰ì²´ê²°","ë‚š2","ì—”ì§„ì–´ìŠ¤",
  "3ì¡°2ë²ˆ","RH ë£¨1","RH ë£¨2"
];

/* =========================
   â€œí•˜ë£¨ì— ëª‡ ë¼ìš´ë“œ ì§„í–‰?â€ ê·œì¹™
   - ê¸°ë³¸: 4ë¼ìš´ë“œ
   - 2026-01-22: 4ë¼ìš´ë“œ íœ´ë¬´(=3ë¼ìš´ë“œë§Œ ì§„í–‰)
========================= */
const ROUNDS_PER_DAY_OVERRIDES = {
  "2026-01-22": 3
};
function roundsPerDay(d){
  const k = isoLocal(d);
  return (k in ROUNDS_PER_DAY_OVERRIDES) ? ROUNDS_PER_DAY_OVERRIDES[k] : 4;
}

/* =========================
   ê·¼ë¬´ì¼ íŒì •
========================= */
function isWork(d){
  if(!d) return false;
  if(d < START) return false;
  if(d.getDay() === 0) return false;         // ì¼ìš”ì¼
  return !HOLIDAYS.includes(isoLocal(d));
}

/* =========================
   BASE_DATE -> targetDate ë¡œ â€œì´ ëª‡ ë¼ìš´ë“œê°€ ì´ë™í–ˆëŠ”ì§€â€
   - ë§¤ ê·¼ë¬´ì¼ë§ˆë‹¤ roundsPerDay(í•´ë‹¹ë‚ ì§œ) ë§Œí¼ ì´ë™
   - targetì´ BASEë³´ë‹¤ ê³¼ê±°ë©´ ë°˜ëŒ€ë¡œ ë¹¼ê¸°
========================= */
function totalShiftRounds(baseDate, targetDate){
  const baseKey = isoLocal(baseDate);
  const targetKey = isoLocal(targetDate);

  if(baseKey === targetKey) return 0;

  // targetì´ ë¯¸ë˜
  if(targetDate > baseDate){
    let sum = 0;
    let t = new Date(baseDate.getTime());
    while(isoLocal(t) !== targetKey){
      // t í•˜ë£¨ê°€ ì§€ë‚˜ë©´ ë‹¤ìŒë‚  ìŠ¤ì¼€ì¤„ì´ "ê·¸ë§Œí¼" ì´ë™
      // ì¦‰, ì˜¤ëŠ˜(t)ì´ ê·¼ë¬´ì¼ì´ë©´ ì˜¤ëŠ˜ ì§„í–‰ ë¼ìš´ë“œ ìˆ˜ë§Œí¼ sum
      if(isWork(t)) sum += roundsPerDay(t);
      t.setDate(t.getDate()+1);
    }
    return sum;
  }

  // targetì´ ê³¼ê±°
  let sum = 0;
  let t = new Date(targetDate.getTime());
  while(isoLocal(t) !== baseKey){
    if(isWork(t)) sum += roundsPerDay(t);
    t.setDate(t.getDate()+1);
  }
  return -sum;
}

/* =========================
   ìŠ¤ì¼€ì¤„ ê³„ì‚°
   - â€œtasks[0]â€ ê³¼ â€œnames[0]â€ì„ ì ê·¸ì§€ ì•ŠìŒ
   - ê¸°ì¤€ì€: BASE_DATEì— BASE_PERSONì´ tasks[0](ì²« ì‘ì—…)ì„ í•œë‹¤
========================= */
function getSchedule(d){
  if(!isWork(d)) return null;

  const baseTaskIdx = 0; // í•­ìƒ "ì‘ì—… ë¦¬ìŠ¤íŠ¸ì˜ ì²«ë²ˆì§¸ ì‘ì—…"
  const basePersonIdx = names.indexOf(BASE_PERSON);
  if(basePersonIdx < 0) return null;

  const shift = totalShiftRounds(BASE_DATE, d);

  const dayRounds = roundsPerDay(d); // 3 ë˜ëŠ” 4
  return names.map((name, personIdx)=>{
    const rounds = [];
    for(let r=0; r<4; r++){
      if(r >= dayRounds){
        rounds.push("íœ´ë¬´"); // 22ì¼ 4R ê°™ì€ ì¼€ì´ìŠ¤
        continue;
      }
      const taskIdx =
        (baseTaskIdx + shift + (personIdx - basePersonIdx) + r + tasks.length * 10)
        % tasks.length;
      rounds.push(tasks[taskIdx]);
    }
    return { name, rounds };
  });
}

/* =========================
   ì¶œë ¥
========================= */
function renderDay(){
  const d = parseDate(document.getElementById("dayDate").value);
  const dayBody = document.getElementById("dayBody");
  const dayWarn = document.getElementById("dayWarn");
  dayBody.innerHTML = "";

  if(!d){
    dayWarn.textContent = "ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.";
    return;
  }
  if(!isWork(d)){
    dayWarn.textContent = "íœ´ë¬´ì¼ì…ë‹ˆë‹¤.";
    return;
  }

  const s = getSchedule(d);
  if(!s){
    dayWarn.textContent = "ìŠ¤ì¼€ì¤„ ê³„ì‚°ì— ë¬¸ì œê°€ ìˆì–´ìš”. (ê¸°ì¤€ ì‘ì—…ì í™•ì¸ í•„ìš”)";
    return;
  }

  dayWarn.textContent = "";
  s.forEach(r=>{
    dayBody.innerHTML += `
      <tr>
        <td class="name-col">${r.name}</td>
        <td class="round-1">${r.rounds[0]}</td>
        <td class="round-2">${r.rounds[1]}</td>
        <td class="round-3">${r.rounds[2]}</td>
        <td class="round-4">${r.rounds[3]}</td>
      </tr>
    `;
  });
}

/* =========================
   ì˜¤ëŠ˜ ë²„íŠ¼
========================= */
function goToday(){
  const t = new Date();
  const d = isWork(t) ? t : BASE_DATE;  // ì˜¤ëŠ˜ì´ íœ´ë¬´ë©´ ê¸°ì¤€ì¼ë¡œ
  document.getElementById("dayDate").value = isoLocal(d);
  renderDay();
}

/* =========================
   ë„ì›€ë§
========================= */
document.getElementById("helpBtn").addEventListener("click", ()=>{
  alert(
    "ë§Œë“ ì‚¬ëŒ : ê¹€ì´ìŠ¬\n" +
    "ë²„ì „ : " + APP_VERSION + "\n" +
    "ìµœì¢… ìˆ˜ì •ì¼ : " + LAST_MODIFIED
  );
});

/* =========================
   ê³µì§€ ì €ì¥(ë‚´ í° ì €ì¥: localStorage)
========================= */
const NOTICE_KEY = "trim2_notice_v1";
const noticeEl = document.getElementById("notice");

function loadNotice(){
  const saved = localStorage.getItem(NOTICE_KEY);
  if(saved !== null) noticeEl.value = saved;
}
function saveNotice(){
  localStorage.setItem(NOTICE_KEY, noticeEl.value || "");
  alert("ê³µì§€ ì €ì¥ ì™„ë£Œ!");
}
function clearNotice(){
  noticeEl.value = "";
  localStorage.removeItem(NOTICE_KEY);
  alert("ê³µì§€ ì‚­ì œ ì™„ë£Œ!");
}

document.getElementById("saveNoticeBtn").addEventListener("click", saveNotice);
document.getElementById("clearNoticeBtn").addEventListener("click", clearNotice);

/* ë©”íƒ€ í‘œì‹œ */
document.getElementById("metaText").textContent =
  "ë²„ì „: " + APP_VERSION + " / ìµœì¢… ìˆ˜ì •ì¼: " + LAST_MODIFIED;

/* ì´ˆê¸° ë¡œë“œ */
loadNotice();
goToday();
</script>

</body>
</html>